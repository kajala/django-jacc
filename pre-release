source venv/bin/activate
python manage.py test
if [ "$?" != "0" ]; then
    echo "Django manage.py test reported problems, terminating release"
    exit 1
fi
echo "Django manage.py test ok, proceeding..."

source venv/bin/activate
pip install prospector --upgrade -q
prospector
if [ "$?" != "0" ]; then
    echo "Prospector reported problems, terminating release"
    exit 1
fi
echo "Prospector cleared build, proceeding..."

source venv/bin/activate
pip install pytype --upgrade -q
pytype --config pytype.cfg
if [ "$?" != "0" ]; then
    echo "Pytype reported problems, terminating release"
    exit 1
fi
echo "Pytype cleared build, proceeding..."

echo "Updating test coverage"
source venv/bin/activate
coverage run --source='.' --omit='*/venv/*' manage.py test
coverage report
git add -A '*'
git commit -m 'test coverage update'
git push

exit 0

